{% extends "base.html" %}

{% block inner_content %}

    {% if user.exercises %}
    <section class="stats">

        <section class="balance {% if user.balance > 0 %}positive{% else %}negative{% endif %}">
            <label>Balance</label>
            <p>{{ user.balance }} <span>pts</span></p>
        </section>

        <section class="streak">
            <label>Current Streak</label>
            <p>{{ user.streak }} <span>days</span></p>
        </section>

        <section class="longest_streak wide">
            <label>Longest Streak</label>
            <p>{{ user.longest_streak }} <span>days</span></p>
        </section>

    </section>
    {% endif %}

    <section class="exercise-list">
        <h3>Exercises</h3>
        <ul>
            {% for exercise in user.exercises %}
            <li>

                <div class="exercise-name">{{ exercise.name }}</div>

                <form class="delete-exercise-form" method="post" action="/user/{{user._id}}/exercise/{{exercise.eid}}/delete">
                    <button><i class="icon-pencil"></i></button>
                </form>

                <form class="deposit-form" method="post" action="/user/{{user._id}}/deposit/{{exercise.value}}">
                    <button class="deposit">{{ exercise.value }}<i class="icon-ok"></i></button>
                </form>

                <div class="exercise-value"></div>
            </li>
            {% endfor %}
        </ul>
        <footer {% if not user.exercises %} class="open" {% endif %}>
            <button class="add-btn">Add Exercise</button>
            <form id="add-form" method="post">

                <div>
                    <label>Description</label>
                    <input name="name" type="text" placeholder="e.g. 25 Pull-ups" />
                </div>

                <div>
                    <label>Points</label>
                    <input name="value" type="number" placeholder="e.g 20" />
                </div>

                <button>Add</button>
            </form>
        </footer>
    </section>



    <script>

        function addDate(e) {
            var today = new Date();
            var dateInput = document.createElement('input');
            dateInput.setAttribute('type', 'hidden');
            dateInput.setAttribute('name', 'date');
            dateInput.setAttribute('value', [
                today.getFullYear(), 
                today.getMonth(), 
                today.getDate()
            ].join('/'));
            e.target.appendChild(dateInput);
        }

        var depositForms = document.querySelectorAll('.deposit-form');

        for (var i = 0; i < depositForms.length; i++) {
            var form = depositForms[i];
            form.addEventListener('submit', addDate);
        }

        var addBtn = document.querySelectorAll('.add-btn')[0];
        var footer = document.querySelectorAll('.exercise-list footer')[0];
        addBtn.addEventListener('click', function(e) {
            footer.classList.add('open');
        });

        function confirmOnDelete (e) {
            var result = confirm('In the future, this will allow editing, but now, clicking ok will delete.');
            if (!result) {
                e.preventDefault();
            }
        }

        var deleteExerciseForms = document.querySelectorAll('.delete-exercise-form');

        for (var i = 0; i < deleteExerciseForms.length; i++) {
            deleteExerciseForms[i].addEventListener('submit', confirmOnDelete);
        }

    </script>
{% endblock %}
